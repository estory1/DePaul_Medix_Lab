<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice 4.1.1  (Unix)">
	<META NAME="CREATED" CONTENT="20150314;21202100">
	<META NAME="CHANGED" CONTENT="20150315;2465700">
	<STYLE TYPE="text/css">
	<!--
		@page { margin: 0.79in }
		P { margin-bottom: 0.08in }
		H1 { margin-bottom: 0.08in }
		H1.western { font-family: "Arial", sans-serif; font-size: 16pt }
		H1.cjk { font-family: "SimSun"; font-size: 16pt }
		H1.ctl { font-family: "Lucida Sans"; font-size: 16pt }
		H2 { margin-bottom: 0.08in }
		H2.western { font-family: "Arial", sans-serif; font-size: 14pt; font-style: italic }
		H2.cjk { font-family: "SimSun"; font-size: 14pt; font-style: italic }
		H2.ctl { font-family: "Lucida Sans"; font-size: 14pt; font-style: italic }
		A:link { so-language: zxx }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1 CLASS="western" ALIGN=CENTER><U>A Developer's Guide to the
Nematodes Data Visualization Tool</U></H1>
<P ALIGN=CENTER STYLE="margin-bottom: 0in">Author: Evan Story</P>
<P ALIGN=CENTER STYLE="margin-bottom: 0in">Date created: Mar. 14,
2015 (Pi day!)</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Refers to the Reader-Accessible Instance of:</U></H2>
<P STYLE="margin-bottom: 0in"><A HREF="https://medixsrv.cstcis.cti.depaul.edu/Nematodes/">https://medixsrv.cstcis.cti.depaul.edu/Nematodes/</A></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Target Audience:</U></H2>
<P STYLE="margin-bottom: 0in">Developers of the data visualization
(“dataviz”) tool for the c.elegans research project under Prof.
Daniela Stan-Raicu.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Expected Knowledge:</U></H2>
<P STYLE="margin-bottom: 0in">Modern web developer knowledge.
Chiefly, in descending order of importance:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">Javascript.</P>
	<LI><P STYLE="margin-bottom: 0in">Basic familiarity with HTTP verbs:
	GET and POST, especially. Also with file management.</P>
	<LI><P STYLE="margin-bottom: 0in">HTML5.</P>
	<LI><P STYLE="margin-bottom: 0in">CSS.</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Related to the above is knowledge of
common ancillary libraries:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">underscore.js.</P>
	<LI><P STYLE="margin-bottom: 0in">c3.js (based on d3.js).</P>
	<LI><P STYLE="margin-bottom: 0in">jQuery.</P>
	<LI><P STYLE="margin-bottom: 0in">Twitter Bootstrap.</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">You'll also need:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">Basic Python.</P>
	<LI><P STYLE="margin-bottom: 0in">Basic statistics.</P>
	<LI><P STYLE="margin-bottom: 0in">Basic familiarity with the Windows
	command-prompt.</P>
	<LI><P STYLE="margin-bottom: 0in">Basic familiarity with Google
	Chrome.</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Overview:</U></H2>
<P STYLE="margin-bottom: 0in">The dataviz tool was conceived with the
goal of providing a convenient means of viewing movement feature data
generated by image processing and analysis of video surveillance of
the c.elegans biological nematode. Development of this tool has
remained focused on that goal.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>First Usage</U></H2>
<P STYLE="margin-bottom: 0in">The tool itself is quite simple and is
designed to be intuitive to any web user. You can get an end-user
sense of its function by performing the following:</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<OL>
	<LI><P STYLE="margin-bottom: 0in">Open Google Chrome. (Firefox and
	Safari on Mac also work, but the tool was only tested on Chrome.)</P>
	<LI><P STYLE="margin-bottom: 0in">Navigate to:
	<A HREF="https://medixsrv.cstcis.cti.depaul.edu/Nematodes/">https://medixsrv.cstcis.cti.depaul.edu/Nematodes/</A></P>
	<LI><P STYLE="margin-bottom: 0in">Ignore the security warning and
	proceed to the page.</P>
	<LI><P STYLE="margin-bottom: 0in; text-decoration: none"><B>----------
	Display your first file, specify window range with the slider, view
	values ----------</B></P>
	<LI><P STYLE="margin-bottom: 0in">In the upper left corner, click
	“Choose Files”.</P>
	<LI><P STYLE="margin-bottom: 0in">Click on a file containing the
	string “binnedMF”.</P>
	<LI><P STYLE="margin-bottom: 0in">A chart should display, as well as
	a table of statistics. Mouse over the chart: you should notice that
	values in the chart display in a tooltip.</P>
	<LI><P STYLE="margin-bottom: 0in">Drag the slider to the right. The
	chart should change, showing a window into the data previously
	displayed in full.</P>
	<LI><P STYLE="margin-bottom: 0in">Reset the view to the full dataset
	by clicking the “Show full series for selected datasets” button.</P>
	<LI><P STYLE="margin-bottom: 0in"><B>---------- Display a second
	file, manually specify window range ----------</B></P>
	<LI><P STYLE="margin-bottom: 0in">Click “Choose Files” again,
	and click on another “binnedMF” dataset. It should display along
	with your first dataset.</P>
	<LI><P STYLE="margin-bottom: 0in">Repeat 7 through 9 to illustrate
	displaying and scrolling through multiple files.</P>
	<LI><P STYLE="margin-bottom: 0in">In the “end” textbox, specify
	a value between 0 and the currently displayed value, then click or
	Tab-key out of the textbox. The chart should update to show the new
	range.</P>
	<LI><P STYLE="margin-bottom: 0in">In the “start” textbox,
	specify a value greater than 0 and less than the end value, then
	click or Tab-key out of the textbox. The chart should update to show
	the new range.</P>
	<LI><P STYLE="margin-bottom: 0in"><B>---------- Show / hide data
	series ----------</B></P>
	<LI><P STYLE="margin-bottom: 0in">In the chart legend, click on a
	data series label. If the series is currently displayed, it will be
	hidden and the label will be grayed-out. Else, the series is hidden,
	and so will be displayed, and the label shown in its full color.</P>
</OL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Developer Use Cases (Or, “I Need to Make
Changes, How Do I Do That?”)</U></H2>
<UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>I Want to Trace
	the Logic. Where Is My Main Function?</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in">Javascript is processed in the
		order in which statements are declared. So, the JS files referenced
		first are interpreted first. Then the JS inside the &lt;script&gt;
		tags.</P>
		<LI><P STYLE="margin-bottom: 0in">Day-to-day, what you may call
		“main()” can be thought of as jQuery's
		$<B>(document).ready(function() { … });</B>.</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in">Note: This executes after the
			document has loaded. This won't run if, for instance, you have a
			syntax error in a referenced file, which breaks the JS interpreter
			earlier.<BR><BR>
			</P>
		</UL>
	</UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>How to Update
	the “Choose file(s)” List</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in">Via Remote Desktop (mstsc.exe on
		Windows, Microsoft Remote Desktop on Mac) to
		<B>medixsrv.cstcis.cti.depaul.edu</B>:</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in">Open <B>cmd.exe</B>.</P>
			<LI><P STYLE="margin-bottom: 0in">Ensure you have Python in your
			<B>%PATH%</B>. If it's not, then:</P>
			<UL>
				<LI><P STYLE="margin-bottom: 0in">Python isn't installed on
				medixsrv for all users, but I have a standalone copy for myself,
				which others can use, at:
				<B>D:\Workspace\Evan\StoryEvan\apps\Portable Python 2.7.6.1\App</B><SPAN STYLE="font-weight: normal">.</SPAN></P>
			</UL>
			<LI><P STYLE="margin-bottom: 0in">Nav to the
			<B>C:\WAMP\apache2\htdocs\Nematodes</B> folder.</P>
			<LI><P STYLE="margin-bottom: 0in">Type (without quotes) &quot;<B>python
			genFileMetadata.py</B>&quot; and hit Enter/Return.</P>
			<LI><P STYLE="margin-bottom: 0in">This re-generates and overwrites
			the file dataFilesMetaObjs.json, which the dataviz tool loads on
			page-load.<BR><BR>
			</P>
		</UL>
	</UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>How to Add a
	Column to the Statistics Table</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">In
		</SPAN><B>index.html</B><SPAN STYLE="font-weight: normal">:</SPAN>
		Add the column to the table inside <B>&lt;div id=&quot;basicStats&quot;&gt;</B>.</P>
		<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">In
		</SPAN><B>index.html</B><SPAN STYLE="font-weight: normal">:</SPAN>
		In the function <B>computeAndRenderBasicStats(dataSetsToDisplay)</B><SPAN STYLE="font-weight: normal">,
		inside the _.each(...) function's element handler function (where
		the rest of the stats are calculated):</SPAN></P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">Add
			the calculation.</SPAN></P>
			<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">Insert
			the calculation result into the jQuery .append() call in the
			ordinally-appropriate position w.r.t. your updated basicStats
			table.<BR></SPAN><BR>
			</P>
		</UL>
	</UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>How to Add a
	Data Set / File Type</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in">In <B>genFileMetadata.py</B>:</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in">Add an <B>if</B> statement which
			matches the file name for the type of file you want. Inside the if
			block:</P>
			<UL>
				<LI><P STYLE="margin-bottom: 0in">Create an object like in the
				other if blocks. It must contain:</P>
				<UL>
					<LI><P STYLE="margin-bottom: 0in"><B>href</B><SPAN STYLE="font-weight: normal">:
					The relative OS path to the file.</SPAN></P>
					<LI><P STYLE="margin-bottom: 0in"><B>name</B><SPAN STYLE="font-weight: normal">:
					The user-visible “friendly” name of the file.</SPAN></P>
					<LI><P STYLE="margin-bottom: 0in"><B>note</B><SPAN STYLE="font-weight: normal">:
					An arbitrary, user-visible descriptive text.</SPAN></P>
					<LI><P STYLE="margin-bottom: 0in"><B>dataSeriesNames</B>: A CSV
					string containing the series names to display (these are i.e.
					the column names in a file that contains column headeres).</P>
					<LI><P STYLE="margin-bottom: 0in"><B>dataSeriesNamesDefaultHidden</B>:
					A CSV string containing the series names to hide by default on
					page load.</P>
					<LI><P STYLE="margin-bottom: 0in"><B>timeSeriesFilterColIdx</B>:
					A JSON object defining where in the input file the dataviz tool
					can find the time-series dimension. This may be either:</P>
					<UL>
						<LI><P STYLE="margin-bottom: 0in">frame ID: { &quot;frame&quot;:
						0, &quot;time&quot;: COL_INDEX }</P>
						<LI><P STYLE="margin-bottom: 0in">time: { &quot;frame&quot;:
						None, &quot;time&quot;: COL_INDEX }</P>
						<UL>
							<LI><P STYLE="margin-bottom: 0in">frame is None because using
							time, a frame ID isn't used. But, using frame ID, then frame
							must be defined as a numeric.</P>
						</UL>
					</UL>
					<LI><P STYLE="margin-bottom: 0in"><B>timeSeriesUnit</B>:
					Displayed to the user, giving a visual sense of what the time
					series unit is.</P>
					<LI><P STYLE="margin-bottom: 0in"><B>type</B>: Defines the file
					type. Must be unique among all file types.</P>
					<LI><P STYLE="margin-bottom: 0in"><B>timeSeriesMax</B>: The
					maximum time value in the data set. Assuming the time value in
					the file, then this will be the frame or time value in the last
					row of the file.</P>
				</UL>
			</UL>
		</UL>
		<LI><P STYLE="margin-bottom: 0in">In <B>index.html</B>:</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in">As a general strategy, you can
			do a find on the string “movementFeatures” to find where
			changes need to be made. Doing this, you specifically find that
			changes need to be made in 3 places:</P>
			<UL>
				<LI><P STYLE="margin-bottom: 0in"><B>updateUserControls(dataSets)</B>:
				Inside the <B>switch(ds.dataSet.metadata.type)</B> block.
				Assuming you're working with time as the timeSeriesUnit (not
				frames), you might get away with just adding a case that
				falls-through to the default case (as “binnedMF” does).</P>
				<LI><P STYLE="margin-bottom: 0in"><B>getNote(dataSetMetadata)</B>:
				Add a case to format the note field properly.</P>
				<LI><P STYLE="margin-bottom: 0in"><B>$(&quot;.showMeEverything&quot;).click(function()</B>:
				Add either an outer if block, if you're adding a new
				timeSeriesUnit, else, add a conditional inside the existing
				blocks.</P>
			</UL>
		</UL>
	</UL>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>How to Remove
	the Security Warning on Page Load</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in">We'd have to get an SSL
		certificate signed by a certificate authority (CA). This is
		something that Depaul's IS dept should be able to help us with
		(though the service is likely outsourced to some SSL certificate
		provider, e.g. Comodo).</P>
		<LI><P STYLE="margin-bottom: 0in">The current self-signed SSL
		certificate involve the files in the folder:</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in"><B>C:\WAMP\apache2\conf</B></P>
			<UL>
				<LI><P STYLE="margin-bottom: 0in"><B>privkey.pem</B><SPAN STYLE="font-weight: normal">
				(PEM-formatted private key)</SPAN></P>
				<LI><P STYLE="margin-bottom: 0in"><B>server.crt</B><SPAN STYLE="font-weight: normal">
				(SSL certificate)</SPAN></P>
				<LI><P STYLE="margin-bottom: 0in"><B>server.csr</B><SPAN STYLE="font-weight: normal">
				(certificate signing request)</SPAN></P>
				<LI><P STYLE="margin-bottom: 0in"><B>server.key</B><SPAN STYLE="font-weight: normal">
				(private key)</SPAN></P>
			</UL>
		</UL>
		<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">Installing
		a new SSL certificate should be as easy as:</SPAN></P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">Replacing
			those files with whatever your SSL registrar sent you.</SPAN></P>
			<LI><P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">Restarting
			Apache.</SPAN></P>
		</UL>
		<P STYLE="margin-bottom: 0in"><SPAN STYLE="font-weight: normal">But
		this blog entry may also be helpful:
		<A HREF="http://blog.lifebloodnetworks.com/?p=677">http://blog.lifebloodnetworks.com/?p=677</A><BR></SPAN><BR>
		</P>
	</UL>
	<LI><P STYLE="margin-bottom: 0in"><FONT SIZE=4><I><B>How to Replace
	the Charting Library (If You Must)</B></I></FONT></P>
	<UL>
		<LI><P STYLE="margin-bottom: 0in">Charting functionality is
		isolated to: 
		</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in"><B>c3Charting.js</B></P>
			<LI><P STYLE="margin-bottom: 0in"><B>index.html: displayChart()</B></P>
		</UL>
		<LI><P STYLE="margin-bottom: 0in">So, replace <B>c3Charting.js</B>
		with your own implementation.</P>
		<UL>
			<LI><P STYLE="margin-bottom: 0in">This basically means copying the
			<B>c3Charting.js</B> code and replacing the definition of
			<B>drawMultiFileMultiLineChart(chartHtmlId, dataSetsToDisplay,
			allHiddenSeries)</B><SPAN STYLE="font-weight: normal">.</SPAN></P>
		</UL>
		<LI><P STYLE="margin-bottom: 0in">Update <B>displayChart()</B> to
		reference your new implementation.</P>
		<LI><P STYLE="margin-bottom: 0in">Update
		<B>applyCustomSeriesToggleClickHandler()</B> to deal with toggling
		data series from the chart (which, conveniently, C3.js handles
		natively already).</P>
	</UL>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Unusual Things (“What Will Trip Me Up That
Nobody Would Think Of?”)</U></H2>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><U><B>NTFS junctions / symlinks
(because almost nobody uses these on Windows)</B></U></P>
<P STYLE="margin-bottom: 0in">On medixsrv.cstcis.cti.depaul.edu, we
use NTFS file junctions (on Unix/Linux, these are known as symlinks)
to enable us to point to the Nematodes data files folders, rather
than duplicate their data. This has the benefits of vastly reduced
disk usage, lower maintenance overhead, and reference to the
authoritative data source.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">For symlinking to the data on medixsrv
(rather than copying), I used the command prompt technique described
here:
<A HREF="http://www.howtogeek.com/howto/16226/complete-guide-to-symbolic-links-symlinks-on-windows-or-linux/">http://www.howtogeek.com/howto/16226/complete-guide-to-symbolic-links-symlinks-on-windows-or-linux/</A>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">The folder root of this data viz page
is: <B>C:\WAMP\apache2\htdocs\Nematodes</B></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">The symlink to the data folder lives at
(and points to): <B>C:\WAMP\apache2\htdocs\Nematodes\data</B> <B>--&gt;
D:\Nematodes\data</B></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">FYI, here's the exact command executed
(in a <B>cmd.exe</B> prompt), from the folder seen below, and the
command's output:</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><B>C:\WAMP\apache2\htdocs\Nematodes&gt;mklink
/J data D:\Nematodes\data</B></P>
<P STYLE="margin-bottom: 0in"><B>Junction created for data &lt;&lt;===&gt;&gt;
D:\Nematodes\data</B></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2 CLASS="western"><U>Known Issues</U></H2>
<OL>
	<LI><P STYLE="margin-bottom: 0in"><B>User-visible</B></P>
	<OL>
		<LI><P STYLE="margin-bottom: 0in">The x-axis of the chart does not
		display the appropriate values for the selected window.</P>
		<OL>
			<LI><P STYLE="margin-bottom: 0in">This is a limitation of C3.js.
			It renders improperly when its option is enabled to display the
			proper values.</P>
			<LI><P STYLE="margin-bottom: 0in">So, as it stands, consider the
			x-axis values as an offset to be added to the minimum value of
			time in your range.</P>
		</OL>
		<LI><P STYLE="margin-bottom: 0in">C3.js seems unable to deal with
		very large files. “Very large” seems to arise when the file has
		somewhere around 100,000 rows. You can see this effect for yourself
		by selecting a “movementFeatures.csv” file with a max frame ID
		value &gt; 100,000.</P>
		<OL>
			<LI><P STYLE="margin-bottom: 0in">Fixing this entails either
			fixing the underlying problem (whatever it is), or replacing the
			charting library. Fixing this problem hasn't happened because in
			practice, users' focus has been on the much smaller “binnedMF”
			data. But for large files, this could be a problem.</P>
		</OL>
	</OL>
	<LI><P STYLE="margin-bottom: 0in"><B>Developer visible</B></P>
	<OL>
		<LI><P STYLE="margin-bottom: 0in">The code is a bit messy. I tried
		to clean it up a bit and refactor, but it needs more love.</P>
		<LI><P STYLE="margin-bottom: 0in">The project is not presently
		under source control (e.g. Git at Github). I'm sorry.</P>
	</OL>
</OL>
</BODY>
</HTML>